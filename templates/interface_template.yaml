{ 
    "interfaces": {
        "{{ name }}": {
            "interface": {
                {% if action == "default_lan" or action == "delete" %}
                    {% if lan or circuit %}
                        "lan": "{{ default_lan }}",
                        "circuit": null,
                        "description": "",
                        "alias": "{{ name }}"{% if sub_interfaces %},{% endif %}
                    {% endif %}
                {% elif action == "add" %}
                    {% if circuit or lan %}
                        "adminStatus": {{ enabled | default('true') }},
                        "loopback": {{ loopback | default(null) }},
                        {% if mtu is defined %}
                            "maxTransmissionUnit": {{ mtu }},
                        {% endif %}
                        {% if circuit %}
                            "circuit": "{{ circuit }}",
                            "description": "{{ description | default(circuit) }}",
                            "alias": "{{ alias | default(circuit) }}",
                        {% elif lan %}
                            "lan": "{{ lan }}",
                            "description": "{{ description | default(lan) }}",
                            "alias": "{{ alias | default(lan) }}",
                            {% if v4_tcp_mss is defined %}
                                "v4TcpMss": {
                                    "tcpMssV4": {{ v4_tcp_mss }}
                                },
                            {% endif %}
                            {% if v6_tcp_mss is defined %}
                                "v6TcpMss": {
                                    "tcpMssV6": {{ v6_tcp_mss }}
                                },
                            {% endif %}
                        {% endif %}
                        "ipv4": {
                            {% if ipv4 %}
                                "address": {
                                    "address": "{{ ipv4 }}"
                                }
                            {% else %}
                                "dhcp": {
                                    "dhcpClient": {{ dhcp | default(true) }}
                                }
                            {% endif %}
                        },
                        "ipv6": {
                            {% if ipv6 %}
                                "address": {
                                    "address": "{{ ipv6 }}"
                                }
                            {% else %}
                                "dhcp": {
                                    "dhcpClient": {{ dhcp | default(true) }}
                                }
                            {% endif %}
                        }{% if sub_interfaces %},{% endif %}
                    {% endif %}
                {% endif %}
                {% if sub_interfaces and (action == "default_lan" or action == "add" or action == "delete") %}
                    "subinterfaces": {
                            {% for sub_interface in sub_interfaces %}
                                "{{ sub_interface.vlan }}": {
                                    {% if action == "default_lan" %}
                                        "interface": {
                                            "lan": "{{ default_lan }}",
                                            "vlan": {{ sub_interface.vlan }},
                                            "circuit": null,
                                            "description": "",
                                            "alias": "{{ name ~ '.' ~ sub_interface.vlan }}",
                                        }
                                    {% elif action == "delete" %}
                                        "interface": null
                                    {% elif action == "add" %}
                                        "interface": {
                                            {% if sub_interface.circuit %}
                                                "circuit": "{{ sub_interface.circuit | default(null) }}",
                                            {% elif sub_interface.lan %}
                                                "lan": "{{ sub_interface.lan | default(null) }}",
                                            {% endif %}
                                            "vlan": {{ sub_interface.vlan }},
                                            "description": "{{ sub_interface.description | default(sub_interface.vlan ~ '_' ~ sub_interface.lan, true) }}",
                                            "alias": "{{ sub_interface.alias | default(sub_interface.vlan ~ '_' ~ sub_interface.lan, true) }}",
                                            "adminStatus": {{ sub_interface.enabled | default('true') }},
                                            "loopback": {{ sub_interface.loopback | default(null) }},
                                            {% if sub_interface.v4_tcp_mss is defined %}
                                                "v4TcpMss": {
                                                    "tcpMssV4": {{ sub_interface.v4_tcp_mss }}
                                                },
                                            {% endif %}
                                            {% if sub_interface.v6_tcp_mss is defined %}
                                                "v6TcpMss": {
                                                    "tcpMssV6": {{ sub_interface.v6_tcp_mss }}
                                                },
                                            {% endif %}
                                            "ipv4": {
                                                {% if sub_interface.ipv4 %}
                                                    "address": {
                                                        "address": "{{ sub_interface.ipv4 }}"
                                                    }
                                                {% else %}
                                                    "dhcp": {
                                                        "dhcpClient": {{ sub_interface.dhcp | default(true) }}
                                                    }
                                                {% endif %}
                                            },
                                            "ipv6": {
                                                {% if sub_interface.ipv6 %}
                                                    "address": {
                                                        "address": "{{ sub_interface.ipv6 }}"
                                                    }
                                                {% else %}
                                                    "dhcp": {
                                                        "dhcpClient": {{ sub_interface.dhcp | default(true) }}
                                                    }
                                                {% endif %}
                                            }
                                        }
                                    {% endif %}
                                },
                            {% endfor %}
                        }
                    {% endif %}
            }
        }
    }
}