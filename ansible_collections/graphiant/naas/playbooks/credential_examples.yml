---
# Example playbook demonstrating various ways to pass Graphiant credentials
# This playbook shows different approaches for credential management

- name: Graphiant Credential Management Examples
  hosts: localhost
  gather_facts: false

  # Option #3 - Variables inside playbook using vars directive
  vars:
    graphiant_host: "https://api.graphiant.com"
    # Uncomment and set your credentials for testing
    # graphiant_username: "your_username"
    # graphiant_password: "your_password"

    # Use YAML anchors to avoid repetition (Recommended approach)
    graphiant_client_params: &graphiant_client_params
      host: "{{ graphiant_host }}"
      username: "{{ graphiant_username }}"
      password: "{{ graphiant_password }}"

  tasks:
    - name: Example 1 - Using YAML anchors (Recommended)
      graphiant.naas.graphiant_global_config:
        <<: *graphiant_client_params
        config_file: "sample_global_prefix_lists.yaml"
        operation: "configure"
        state: present
      check_mode: true
      tags: ['example1', 'yaml_anchors']

    - name: Example 2 - Direct variable substitution
      graphiant.naas.graphiant_global_config:
        host: "{{ graphiant_host }}"
        username: "{{ graphiant_username }}"
        password: "{{ graphiant_password }}"
        config_file: "sample_global_prefix_lists.yaml"
        operation: "configure"
        state: present
      check_mode: true
      tags: ['example2', 'direct_vars']

    - name: Example 3 - Using environment variables
      graphiant.naas.graphiant_global_config:
        host: "{{ lookup('env', 'GRAPHIANT_HOST') | default(graphiant_host) }}"
        username: "{{ lookup('env', 'GRAPHIANT_USERNAME') | default(graphiant_username) }}"
        password: "{{ lookup('env', 'GRAPHIANT_PASSWORD') | default(graphiant_password) }}"
        config_file: "sample_global_prefix_lists.yaml"
        operation: "configure"
        state: present
      check_mode: true
      tags: ['example3', 'env_vars']

    - name: Example 4 - Using INI file with lookup (Deprecated - Use environment variables instead)
      graphiant.naas.graphiant_global_config:
        # NOTE: test.ini file has been removed. Use environment variables (Example 3) instead.
        # This example is kept for reference only and will not work without creating a custom INI file.
        host: "{{ lookup('ini', 'url file=/absolute/path/test/test.ini section=host') }}"
        username: "{{ lookup('ini', 'username file=/absolute/path/test/test.ini section=credentials') }}"
        password: "{{ lookup('ini', 'password file=/absolute/path/test/test.ini section=credentials') }}"
        config_file: "sample_global_prefix_lists.yaml"
        operation: "configure"
        state: present
      check_mode: true
      tags: ['example4', 'ini_lookup', 'deprecated']
      when: false  # Disabled - use environment variables instead

    - name: Display credential management information
      ansible.builtin.debug:
        msg:
          - "ðŸ“‹ Graphiant Credential Management Examples"
          - ""
          - "ðŸ” Available credential management options:"
          - "  1. YAML Anchors (Recommended) - Clean and DRY"
          - "  2. Direct Variables - Simple but repetitive"
          - "  3. Environment Variables (Recommended for CI/CD) - Secure and flexible"
          - "  4. INI File with Lookup (Deprecated) - Use environment variables instead"
          - "  5. Inventory Variables - Host/group specific"
          - "  6. Variable Files - External credential files"
          - "  7. Runtime Variables - Command line override"
          - ""
          - "ðŸ“š See README.md for detailed examples of each approach"
